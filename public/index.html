<!DOCTYPE html>
<html lang="en">
  <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>CrewOps - Production Crew Management</title>
      <script src="https://cdn.tailwindcss.com"></script>
      <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
      <style>
                * { margin: 0; padding: 0; box-sizing: border-box; }
                body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f8fafc; }
                .nav-tab { @apply px-4 py-3 text-sm font-medium cursor-pointer transition-all border-b-2 border-transparent; }
                .nav-tab.active { @apply border-blue-600 text-blue-600 bg-white; }
                .nav-tab:hover { @apply text-gray-700; }
                .card { @apply bg-white rounded-lg shadow-sm border border-gray-200; }
                .btn-primary { @apply px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors; }
                .btn-secondary { @apply px-4 py-2 bg-gray-200 text-gray-800 rounded-lg font-medium hover:bg-gray-300 transition-colors; }
                .input-field { @apply w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500; }
                .modal { @apply fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50; }
                .modal-content { @apply bg-white rounded-lg shadow-lg p-6 w-full max-w-md; }
                .status-badge { @apply inline-block px-3 py-1 rounded-full text-sm font-medium; }
                .status-green { @apply bg-green-100 text-green-800; }
                .status-yellow { @apply bg-yellow-100 text-yellow-800; }
                .status-red { @apply bg-red-100 text-red-800; }
            </style>
  </head>
  <body class="bg-gray-50">
        <div id="app" class="min-h-screen">
                  <header class="bg-white border-b border-gray-200 shadow-sm">
                                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
                                                  <div class="flex items-center gap-3">
                                                                        <div class="text-3xl font-bold text-blue-600">⚡</div>div>
                                                                        <h1 class="text-2xl font-bold text-gray-900">CrewOps</h1>h1>
                                                                        <span class="text-gray-500 text-sm">Production Crew Management</span>span>
                                                  </div>div>
                                </div>div>
                                <div class="flex border-t border-gray-200 bg-gray-50">
                                                  <div class="max-w-7xl mx-auto px-4 flex w-full">
                                                                        <button onclick="switchTab('dashboard')" class="nav-tab active" data-tab="dashboard">
                                                                                                  <i class="fas fa-chart-line mr-2"></i>i>Dashboard
                                                                        </button>button>
                                                                        <button onclick="switchTab('crew')" class="nav-tab" data-tab="crew">
                                                                                                  <i class="fas fa-users mr-2"></i>i>Crew Management
                                                                        </button>button>
                                                                        <button onclick="switchTab('projects')" class="nav-tab" data-tab="projects">
                                                                                                  <i class="fas fa-briefcase mr-2"></i>i>Projects
                                                                        </button>button>
                                                                        <button onclick="switchTab('tracking')" class="nav-tab" data-tab="tracking">
                                                                                                  <i class="fas fa-clock mr-2"></i>i>Time Tracking
                                                                        </button>button>
                                                                        <button onclick="switchTab('integrations')" class="nav-tab" data-tab="integrations">
                                                                                                  <i class="fas fa-plug mr-2"></i>i>Integrations
                                                                        </button>button>
                                                  </div>div>
                                </div>div>
                  </header>header>

                  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                                <div id="dashboard-tab" class="tab-content">
                                                  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                                                                        <div class="card p-6">
                                                                                                  <div class="flex items-center justify-between">
                                                                                                                                <div>
                                                                                                                                                                  <p class="text-sm text-gray-600 font-medium">Active Projects</p>p>
                                                                                                                                                                  <p class="text-3xl font-bold text-gray-900 mt-1" id="kpi-projects">0</p>p>
                                                                                                                                  </div>
                                                                                                                                <i class="fas fa-briefcase text-3xl text-blue-200"></i>i>
                                                                                                    </div>
                                                                        </div>
                                                                        <div class="card p-6">
                                                                                                  <div class="flex items-center justify-between">
                                                                                                                                <div>
                                                                                                                                                                  <p class="text-sm text-gray-600 font-medium">Total Crew</p>p>
                                                                                                                                                                  <p class="text-3xl font-bold text-gray-900 mt-1" id="kpi-crew">0</p>p>
                                                                                                                                  </div>
                                                                                                                                <i class="fas fa-users text-3xl text-green-200"></i>i>
                                                                                                    </div>
                                                                        </div>
                                                                        <div class="card p-6">
                                                                                                  <div class="flex items-center justify-between">
                                                                                                                                <div>
                                                                                                                                                                  <p class="text-sm text-gray-600 font-medium">Hours Logged</p>p>
                                                                                                                                                                  <p class="text-3xl font-bold text-gray-900 mt-1" id="kpi-hours">0</p>p>
                                                                                                                                  </div>
                                                                                                                                <i class="fas fa-hourglass text-3xl text-yellow-200"></i>i>
                                                                                                    </div>
                                                                        </div>
                                                                        <div class="card p-6">
                                                                                                  <div class="flex items-center justify-between">
                                                                                                                                <div>
                                                                                                                                                                  <p class="text-sm text-gray-600 font-medium">Budget Used</p>p>
                                                                                                                                                                  <p class="text-3xl font-bold text-gray-900 mt-1" id="kpi-budget">$0</p>p>
                                                                                                                                  </div>
                                                                                                                                <i class="fas fa-dollar-sign text-3xl text-purple-200"></i>i>
                                                                                                    </div>
                                                                        </div>
                                                  </div>
                                                  <div class="card p-6">
                                                                        <h2 class="text-xl font-bold text-gray-900 mb-4">Recent Projects</h2>h2>
                                                                        <div id="dashboard-projects" class="space-y-3">
                                                                                                  <p class="text-gray-500">No projects yet. Create one to get started!</p>p>
                                                                        </div>
                                                  </div>
                                </div>

                                <div id="crew-tab" class="tab-content hidden">
                                                  <div class="flex justify-between items-center mb-6">
                                                                        <h2 class="text-2xl font-bold text-gray-900">Crew Management</h2>h2>
                                                                        <button onclick="openCrewModal()" class="btn-primary">
                                                                                                  <i class="fas fa-plus mr-2"></i>i>Add Crew Member
                                                                        </button>button>
                                                  </div>
                                                  <div id="crew-list" class="space-y-3">
                                                                        <p class="text-gray-500">No crew members yet.</p>p>
                                                  </div>
                                </div>

                                <div id="projects-tab" class="tab-content hidden">
                                                  <div class="flex justify-between items-center mb-6">
                                                                        <h2 class="text-2xl font-bold text-gray-900">Projects</h2>h2>
                                                                        <button onclick="openProjectModal()" class="btn-primary">
                                                                                                  <i class="fas fa-plus mr-2"></i>i>New Project
                                                                        </button>button>
                                                  </div>
                                                  <div id="projects-list" class="space-y-3">
                                                                        <p class="text-gray-500">No projects yet.</p>p>
                                                  </div>
                                </div>

                                <div id="tracking-tab" class="tab-content hidden">
                                                  <div class="flex justify-between items-center mb-6">
                                                                        <h2 class="text-2xl font-bold text-gray-900">Time Tracking</h2>h2>
                                                  </div>
                                                  <div class="card p-6 mb-6">
                                                                        <h3 class="text-lg font-bold text-gray-900 mb-4">New Time Entry</h3>h3>
                                                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                                                                  <div>
                                                                                                                                <label class="block text-sm font-medium text-gray-700 mb-2">Crew Member</label>label>
                                                                                                                                <select id="time-crew" class="input-field">
                                                                                                                                                                  <option>Select crew member...</option>
                                                                                                                                  </select>select>
                                                                                                    </div>
                                                                                                <div>
                                                                                                                            <label class="block text-sm font-medium text-gray-700 mb-2">Project</label>label>
                                                                                                                            <select id="time-project" class="input-field">
                                                                                                                                                            <option>Select project...</option>
                                                                                                                              </select>select>
                                                                                                  </div>
                                                                                                <div>
                                                                                                                            <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>label>
                                                                                                                            <input type="date" id="time-date" class="input-field">
                                                                                                  </div>
                                                                                                <div>
                                                                                                                            <label class="block text-sm font-medium text-gray-700 mb-2">Hours</label>label>
                                                                                                                            <input type="number" id="time-hours" class="input-field" placeholder="8" min="0.5" step="0.5">
                                                                                                  </div>
                                                                                                <div class="md:col-span-2">
                                                                                                                            <label class="block text-sm font-medium text-gray-700 mb-2">Notes</label>label>
                                                                                                                            <textarea id="time-notes" class="input-field" rows="2" placeholder="Optional notes..."></textarea>
                                                                                                  </div>
                                                                                                <div class="md:col-span-2">
                                                                                                                            <button onclick="addTimeEntry()" class="btn-primary w-full">Log Time Entry</button>button>
                                                                                                  </div>
                                                                        </div>
                                                  </div>
                                                <div class="card p-6">
                                                                    <h3 class="text-lg font-bold text-gray-900 mb-4">Time Entries</h3>h3>
                                                                    <div id="time-entries" class="space-y-3">
                                                                                            <p class="text-gray-500">No time entries yet.</p>p>
                                                                    </div>
                                                </div>
                                </div>
                  
                              <div id="integrations-tab" class="tab-content hidden">
                                              <h2 class="text-2xl font-bold text-gray-900 mb-6">Platform Integrations</h2>h2>
                                              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                                  <div class="card p-6">
                                                                                          <div class="flex items-center gap-3 mb-4">
                                                                                                                      <i class="fab fa-slack text-2xl" style="color: #36c5f0;"></i>i>
                                                                                                                      <h3 class="text-lg font-bold">Slack</h3>h3>
                                                                                            </div>
                                                                                          <p class="text-sm text-gray-600 mb-4">Receive budget and deadline alerts</p>p>
                                                                                          <input type="text" id="slack-token" placeholder="Webhook URL" class="input-field text-sm mb-3">
                                                                                          <div class="flex gap-2">
                                                                                                                      <button onclick="saveIntegration('slack')" class="btn-primary flex-1 text-sm">Save</button>button>
                                                                                                                      <button onclick="testIntegration('slack')" class="btn-secondary flex-1 text-sm">Test</button>button>
                                                                                            </div>
                                                                                          <div id="slack-status" class="text-xs text-gray-500 mt-3"></div>
                                                                  </div>
                                              
                                                                  <div class="card p-6">
                                                                                          <div class="flex items-center gap-3 mb-4">
                                                                                                                      <i class="fas fa-diagram-project text-2xl" style="color: #6b7280;"></i>i>
                                                                                                                      <h3 class="text-lg font-bold">Basecamp</h3>h3>
                                                                                            </div>
                                                                                          <p class="text-sm text-gray-600 mb-4">Sync projects with Basecamp</p>p>
                                                                                          <input type="text" id="basecamp-token" placeholder="API Token" class="input-field text-sm mb-3">
                                                                                          <div class="flex gap-2">
                                                                                                                      <button onclick="saveIntegration('basecamp')" class="btn-primary flex-1 text-sm">Save</button>button>
                                                                                                                      <button onclick="testIntegration('basecamp')" class="btn-secondary flex-1 text-sm">Test</button>button>
                                                                                            </div>
                                                                                          <div id="basecamp-status" class="text-xs text-gray-500 mt-3"></div>
                                                                  </div>
                                              
                                                                  <div class="card p-6">
                                                                                          <div class="flex items-center gap-3 mb-4">
                                                                                                                      <i class="fas fa-calendar text-2xl" style="color: #ea4335;"></i>i>
                                                                                                                      <h3 class="text-lg font-bold">Google Calendar</h3>h3>
                                                                                            </div>
                                                                                          <p class="text-sm text-gray-600 mb-4">Auto-sync deadlines</p>p>
                                                                                          <input type="text" id="google-token" placeholder="API Token" class="input-field text-sm mb-3">
                                                                                          <div class="flex gap-2">
                                                                                                                      <button onclick="saveIntegration('google')" class="btn-primary flex-1 text-sm">Save</button>button>
                                                                                                                      <button onclick="testIntegration('google')" class="btn-secondary flex-1 text-sm">Test</button>button>
                                                                                            </div>
                                                                                          <div id="google-status" class="text-xs text-gray-500 mt-3"></div>
                                                                  </div>
                                              
                                                                  <div class="card p-6">
                                                                                          <div class="flex items-center gap-3 mb-4">
                                                                                                                      <i class="fab fa-linkedin text-2xl" style="color: #0a66c2;"></i>i>
                                                                                                                      <h3 class="text-lg font-bold">LinkedIn</h3>h3>
                                                                                            </div>
                                                                                          <p class="text-sm text-gray-600 mb-4">Enrich crew profiles</p>p>
                                                                                          <input type="text" id="linkedin-token" placeholder="API Token" class="input-field text-sm mb-3">
                                                                                          <div class="flex gap-2">
                                                                                                                      <button onclick="saveIntegration('linkedin')" class="btn-primary flex-1 text-sm">Save</button>button>
                                                                                                                      <button onclick="testIntegration('linkedin')" class="btn-secondary flex-1 text-sm">Test</button>button>
                                                                                            </div>
                                                                                          <div id="linkedin-status" class="text-xs text-gray-500 mt-3"></div>
                                                                  </div>
                                              </div>
                              </div>
                  </main>main>
        </div>
  
      <div id="crew-modal" class="modal hidden">
              <div class="modal-content">
                          <h2 class="text-xl font-bold text-gray-900 mb-4">Add Crew Member</h2>h2>
                          <div class="space-y-3">
                                          <input type="text" id="crew-name" placeholder="Full Name" class="input-field">
                                          <select id="crew-role" class="input-field">
                                                              <option>Select Role...</option>
                                                              <option>Camera Operator</option>
                                                              <option>Sound Engineer</option>
                                                              <option>Grip</option>
                                                              <option>Gaffer</option>
                                                              <option>Production Assistant</option>
                                                              <option>Art Director</option>
                                          </select>select>
                                          <input type="number" id="crew-rate" placeholder="Hourly Rate ($)" class="input-field">
                                          <input type="text" id="crew-linkedin" placeholder="LinkedIn URL" class="input-field">
                                          <input type="text" id="crew-skills" placeholder="Skills" class="input-field">
                                          <div class="flex gap-2 pt-4">
                                                              <button onclick="saveCrew()" class="btn-primary flex-1">Add</button>button>
                                                              <button onclick="closeCrewModal()" class="btn-secondary flex-1">Cancel</button>button>
                                          </div>
                          </div>
              </div>
      </div>
  
      <div id="project-modal" class="modal hidden">
              <div class="modal-content">
                          <h2 class="text-xl font-bold text-gray-900 mb-4">Create Project</h2>h2>
                          <div class="space-y-3">
                                          <input type="text" id="project-name" placeholder="Project Name" class="input-field">
                                          <textarea id="project-desc" placeholder="Description" class="input-field" rows="2"></textarea>
                                          <input type="number" id="project-budget" placeholder="Budget ($)" class="input-field">
                                          <input type="date" id="project-deadline" class="input-field">
                                          <input type="number" id="project-hours" placeholder="Est. Hours" class="input-field">
                                          <div class="flex gap-2 pt-4">
                                                              <button onclick="saveProject()" class="btn-primary flex-1">Create</button>button>
                                                              <button onclick="closeProjectModal()" class="btn-secondary flex-1">Cancel</button>button>
                                          </div>
                          </div>
              </div>
      </div>
  
      <script>
                let data = {crew: [], projects: [], timeEntries: [], integrations: {}};

                function loadData() {
                              const saved = localStorage.getItem('crewops-data');
                              if (saved) data = JSON.parse(saved);
                              document.getElementById('time-date').valueAsDate = new Date();
                }

                function saveData() {
                              localStorage.setItem('crewops-data', JSON.stringify(data));
                              updateDashboard();
                }

                function switchTab(tabName) {
                              document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
                              document.querySelectorAll('.nav-tab').forEach(b => b.classList.remove('active'));
                              document.getElementById(tabName + '-tab').classList.remove('hidden');
                              document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                              if (tabName === 'crew') updateCrewList();
                              else if (tabName === 'projects') updateProjectsList();
                              else if (tabName === 'tracking') updateTimeEntries();
                }

                function openCrewModal() { document.getElementById('crew-modal').classList.remove('hidden'); }
                function closeCrewModal() {
                              document.getElementById('crew-modal').classList.add('hidden');
                              document.getElementById('crew-name').value = '';
                              document.getElementById('crew-role').value = '';
                              document.getElementById('crew-rate').value = '';
                              document.getElementById('crew-linkedin').value = '';
                              document.getElementById('crew-skills').value = '';
                }

                function saveCrew() {
                              const crew = {
                                                id: Date.now(),
                                                name: document.getElementById('crew-name').value,
                                                role: document.getElementById('crew-role').value,
                                                rate: parseFloat(document.getElementById('crew-rate').value) || 0,
                                                linkedin: document.getElementById('crew-linkedin').value,
                                                skills: document.getElementById('crew-skills').value
                              };
                              if (!crew.name || !crew.role) { alert('Fill required fields'); return; }
                              data.crew.push(crew);
                              saveData();
                              closeCrewModal();
                              updateCrewList();
                }

                function updateCrewList() {
                              const list = document.getElementById('crew-list');
                              if (data.crew.length === 0) {
                                                list.innerHTML = '<p class="text-gray-500">No crew members yet.</p>';
                                                return;
                              }
                              list.innerHTML = data.crew.map(m => `
                                              <div class="card p-4">
                                                                  <div class="flex justify-between">
                                                                                          <div>
                                                                                                                      <h3 class="font-bold text-gray-900">${m.name}</h3>
                                                                                                                                                  <p class="text-sm text-gray-600 mt-1"><i class="fas fa-briefcase w-4"></i> ${m.role}</p>
                                                                                                                                                                              <p class="text-sm text-gray-600"><i class="fas fa-dollar-sign w-4"></i> $${m.rate}/hr</p>
                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                              <button onclick="deleteCrew(${m.id})" class="text-red-600"><i class="fas fa-trash"></i></button>
                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                              `).join('');
                              updateSelectOptions();
                }

                function deleteCrew(id) {
                              data.crew = data.crew.filter(c => c.id !== id);
                              saveData();
                              updateCrewList();
                }

                function openProjectModal() { document.getElementById('project-modal').classList.remove('hidden'); }
                function closeProjectModal() {
                              document.getElementById('project-modal').classList.add('hidden');
                              document.getElementById('project-name').value = '';
                              document.getElementById('project-desc').value = '';
                              document.getElementById('project-budget').value = '';
                              document.getElementById('project-deadline').value = '';
                              document.getElementById('project-hours').value = '';
                }

                function saveProject() {
                              const proj = {
                                                id: Date.now(),
                                                name: document.getElementById('project-name').value,
                                                description: document.getElementById('project-desc').value,
                                                budget: parseFloat(document.getElementById('project-budget').value) || 0,
                                                deadline: document.getElementById('project-deadline').value,
                                                estimatedHours: parseFloat(document.getElementById('project-hours').value) || 0,
                                                status: 'active'
                              };
                              if (!proj.name) { alert('Enter project name'); return; }
                              data.projects.push(proj);
                              saveData();
                              closeProjectModal();
                              updateProjectsList();
                }

                function updateProjectsList() {
                              const list = document.getElementById('projects-list');
                              if (data.projects.length === 0) {
                                                list.innerHTML = '<p class="text-gray-500">No projects yet.</p>';
                                                return;
                              }
                              list.innerHTML = data.projects.map(p => {
                                                const hoursUsed = data.timeEntries.filter(e => e.projectId === p.id).reduce((s, e) => s + e.hours, 0);
                                                const budgetUsed = data.timeEntries.filter(e => e.projectId === p.id).reduce((s, e) => s + e.cost, 0);
                                                const isAtRisk = new Date(p.deadline) < new Date() || budgetUsed > p.budget;
                                                return `
                                                                    <div class="card p-4">
                                                                                            <div class="flex justify-between items-start mb-3">
                                                                                                                        <div>
                                                                                                                                                        <h3 class="font-bold text-gray-900">${p.name}</h3>
                                                                                                                                                                                        <p class="text-sm text-gray-600">${p.description}</p>
                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                                                ${isAtRisk ? '<span class="status-badge status-red">⚠️ At Risk</span>' : '<span class="status-badge status-green">✓ On Track</span>'}
                                                                                                                                                                                                                                                                        </div>
                                                                                                                                                                                                                                                                                                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                                                                                                                                                                                                                                                                                                                            <div><p class="text-gray-500">Budget</p><p class="font-semibold">$${p.budget}</p></div>
                                                                                                                                                                                                                                                                                                                                                        <div><p class="text-gray-500">Hours</p><p class="font-semibold">${hoursUsed}/${p.estimatedHours}</p></div>
                                                                                                                                                                                                                                                                                                                                                                                    <div><p class="text-gray-500">Deadline</p><p class="font-semibold">${new Date(p.deadline).toLocaleDateString()}</p></div>
                                                                                                                                                                                                                                                                                                                                                                                                                <div class="text-right"><button onclick="deleteProject(${p.id})" class="text-red-600"><i class="fas fa-trash"></i></button></div>
                                                                                                                                                                                                                                                                                                                                                                                                                                        </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            `;
                              }).join('');
                              updateSelectOptions();
                }

                function deleteProject(id) {
                              data.projects = data.projects.filter(p => p.id !== id);
                              saveData();
                              updateProjectsList();
                }

                function addTimeEntry() {
                              const crewId = document.getElementById('time-crew').value;
                              const projectId = document.getElementById('time-project').value;
                              const date = document.getElementById('time-date').value;
                              const hours = parseFloat(document.getElementById('time-hours').value);
                              const notes = document.getElementById('time-notes').value;

                              if (!crewId || !projectId || !date || !hours) { alert('Fill all required fields'); return; }

                              const crew = data.crew.find(c => c.id == crewId);
                              const project = data.projects.find(p => p.id == projectId);

                              const entry = {
                                                id: Date.now(),
                                                crewId: parseInt(crewId),
                                                crewName: crew.name,
                                                crewRate: crew.rate,
                                                projectId: parseInt(projectId),
                                                projectName: project.name,
                                                date: date,
                                                hours: hours,
                                                cost: hours * crew.rate,
                                                notes: notes
                              };

                              data.timeEntries.push(entry);
                              saveData();
                              document.getElementById('time-crew').value = '';
                              document.getElementById('time-project').value = '';
                              document.getElementById('time-date').valueAsDate = new Date();
                              document.getElementById('time-hours').value = '';
                              document.getElementById('time-notes').value = '';
                              updateTimeEntries();
                }

                function updateTimeEntries() {
                              const list = document.getElementById('time-entries');
                              const crewSel = document.getElementById('time-crew');
                              const projSel = document.getElementById('time-project');

                              crewSel.innerHTML = '<option>Select crew...</option>' + data.crew.map(c => `<option value="${c.id}">${c.name} ($${c.rate}/hr)</option>`).join('');
                              projSel.innerHTML = '<option>Select project...</option>' + data.projects.map(p => `<option value="${p.id}">${p.name}</option>`).join('');

                              if (data.timeEntries.length === 0) {
                                                list.innerHTML = '<p class="text-gray-500">No time entries yet.</p>';
                                                return;
                              }

                              list.innerHTML = data.timeEntries.sort((a, b) => new Date(b.date) - new Date(a.date)).map(e => `
                                              <div class="card p-4">
                                                                  <div class="flex justify-between items-start">
                                                                                          <div class="flex-1">
                                                                                                                      <p class="font-semibold text-gray-900">${e.crewName} - ${e.projectName}</p>
                                                                                                                                                  <p class="text-sm text-gray-600">${new Date(e.date).toLocaleDateString()} • ${e.hours}hrs</p>
                                                                                                                                                                              ${e.notes ? `<p class="text-sm text-gray-500 mt-1">${e.notes}</p>` : ''}
                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                              <div class="text-right">
                                                                                                                                                                                                                                                          <p class="font-semibold text-gray-900">$${e.cost.toFixed(2)}</p>
                                                                                                                                                                                                                                                                                      <button onclick="deleteTimeEntry(${e.id})" class="text-red-600 text-sm">Delete</button>
                                                                                                                                                                                                                                                                                                              </div>
                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                  </div>
                                                                                                                                                                                                                                                                                                                                                              `).join('');
                }

                function deleteTimeEntry(id) {
                              data.timeEntries = data.timeEntries.filter(e => e.id !== id);
                              saveData();
                              updateTimeEntries();
                }

                function updateDashboard() {
                              document.getElementById('kpi-projects').textContent = data.projects.filter(p => p.status === 'active').length;
                              document.getElementById('kpi-crew').textContent = data.crew.length;
                              const totalHours = data.timeEntries.reduce((s, e) => s + e.hours, 0);
                              document.getElementById('kpi-hours').textContent = totalHours.toFixed(1);
                              const totalBudget = data.timeEntries.reduce((s, e) => s + e.cost, 0);
                              document.getElementById('kpi-budget').textContent = '$' + totalBudget.toFixed(2);

                              const dashProj = document.getElementById('dashboard-projects');
                              const recent = data.projects.slice(-3).reverse();
                              if (recent.length === 0) {
                                                dashProj.innerHTML = '<p class="text-gray-500">No projects yet. Create one to get started!</p>';
                              } else {
                                                dashProj.innerHTML = recent.map(p => {
                                                                      const hu = data.timeEntries.filter(e => e.projectId === p.id).reduce((s, e) => s + e.hours, 0);
                                                                      const bu = data.timeEntries.filter(e => e.projectId === p.id).reduce((s, e) => s + e.cost, 0);
                                                                      const atRisk = new Date(p.deadline) < new Date() || bu > p.budget;
                                                                      return `
                                                                                              <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                                                                                                                          <div>
                                                                                                                                                          <p class="font-semibold text-gray-900">${p.name}</p>
                                                                                                                                                                                          <p class="text-sm text-gray-600">${hu.toFixed(1)}hrs • $${bu.toFixed(2)}</p>
                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                  ${atRisk ? '<span class="text-red-600">⚠️ At Risk</span>' : '<span class="text-green-600">✓ On Track</span>'}
                                                                                                                                                                                                                                                                          </div>
                                                                                                                                                                                                                                                                                              `;
                                                }).join('');
                              }
                }

                function updateSelectOptions() {
                              const c = document.getElementById('time-crew');
                              const p = document.getElementById('time-project');
                              if (c) c.innerHTML = '<option>Select crew...</option>' + data.crew.map(x => `<option value="${x.id}">${x.name}</option>`).join('');
                              if (p) p.innerHTML = '<option>Select project...</option>' + data.projects.map(x => `<option value="${x.id}">${x.name}</option>`).join('');
                }

                function saveIntegration(platform) {
                              const token = document.getElementById(platform + '-token').value;
                              if (!token) { alert('Enter API token'); return; }
                              data.integrations[platform] = token;
                              saveData();
                              document.getElementById(platform + '-status').textContent = '✓ Saved';
                }

                function testIntegration(platform) {
                              const status = document.getElementById(platform + '-status');
                              status.textContent = 'Testing...';
                              setTimeout(() => {
                                                const token = document.getElementById(platform + '-token').value;
                                                status.textContent = token ? '✓ Connected' : '✗ No token';
                              }, 1000);
                }

                loadData();
                updateDashboard();
      </script>
  </body>body>
</html>html>
      </script></option></option>
                                                                                                                                </div>
                                                                                                                                </div>
      </style></title>
  </head>
